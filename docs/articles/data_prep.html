<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Preparation • streamMetabolizer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data Preparation">
<meta property="og:description" content="streamMetabolizer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">streamMetabolizer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_prep.html">Data Preparation</a>
    </li>
    <li>
      <a href="../articles/get_started.html">Quickstart</a>
    </li>
    <li>
      <a href="../articles/gpp_er_eqs.html">GPP and ER Equations</a>
    </li>
    <li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/model_structures.html">Model Structures</a>
    </li>
    <li>
      <a href="../articles/models_bayes.html">Bayesian Models</a>
    </li>
    <li>
      <a href="../articles/models_mle.html">MLE Models</a>
    </li>
    <li>
      <a href="../articles/ode_methods.html">ODE Methods</a>
    </li>
    <li>
      <a href="../articles/simulations.html">Simulations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USGS-R/streamMetabolizer/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="data_prep_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Preparation</h1>
                        <h4 class="author">Alison Appling and Bob Hall</h4>
            
            <h4 class="date">2021-07-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/streamMetabolizer/blob/master/vignettes/data_prep.Rmd"><code>vignettes/data_prep.Rmd</code></a></small>
      <div class="hidden name"><code>data_prep.Rmd</code></div>

    </div>

    
    
<div id="requirements" class="section level1">
<h1 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h1>
<p>A properly formatted input dataset for streamMetabolizer models has:</p>
<ul>
<li>exactly the right data columns and column names. Call <code><a href="../reference/metab_inputs.html">metab_inputs()</a></code> to see the requirements for a specific model type.</li>
<li>data in the right units. See <code><a href="../reference/mm_data.html">?mm_data</a></code> for definitions of each column.</li>
</ul>
<p>An input dataset may optionally include:</p>
<ul>
<li>partial days; partial days will be automatically excluded, so you don’t need to do this yourself.</li>
<li>non-continuous days; no current streamMetabolizer models require continuous days.</li>
</ul>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>An example of a properly formatted input dataset is available in the streamMetabolizer package - data are from French Creek in Laramie, WY, courtesy of Bob Hall. Explicitly attached units are optional but useful for confirming that the data are in the expected format.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USGS-R/streamMetabolizer">streamMetabolizer</a></span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_metab.html">data_metab</a></span><span class="op">(</span>num_days<span class="op">=</span><span class="st">'3'</span>, res<span class="op">=</span><span class="st">'15'</span>, attach.units<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: The `attach.units` argument of `data_metab()` is deprecated as of streamMetabolizer 0.12.0.
## In the future, streamMetabolizer will stop using the unitted package entirely.</code></pre>
<pre><code>## Warning: The `attach.units` argument of `load_french_creek()` is deprecated as of streamMetabolizer 0.12.0.
## In the future, streamMetabolizer will stop using the unitted package entirely.</code></pre>
<p>Inspect the dimensions, column names, and units of the data. Note that <code>unitted</code> data.frames, such as the one returned by <code><a href="../reference/data_metab.html">data_metab(..., attach.units=TRUE)</a></code>, prints out with a second row called ‘U’ giving the units for each column. Again, you can use a regular old data.frame for your data, but make sure the units of your data are the same as in this example.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 288   6</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">48</span>,<span class="fl">96</span>,<span class="fl">240</span>,<span class="fl">288</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># some example rows</span></code></pre></div>
<pre><code>##               solar.time    DO.obs    DO.sat depth temp.water          light
## U                        mgO2 L^-1 mgO2 L^-1     m       degC umol m^-2 s^-1
## 5689 2012-09-18 04:05:58      8.41  9.083329  0.16       3.60         0.0000
## 5830 2012-09-18 15:50:58      8.36  7.403370  0.16      11.80       925.1370
## 5974 2012-09-19 03:50:58      8.17  8.927566  0.16       4.25         0.0000
## 6404 2012-09-20 15:50:58      8.35  7.358846  0.16      12.06       898.9231
## 6548 2012-09-21 03:50:58      8.21  8.854844  0.16       4.56         0.0000</code></pre>
</div>
<div id="exploring-input-data" class="section level1">
<h1 class="hasAnchor">
<a href="#exploring-input-data" class="anchor"></a>Exploring input data</h1>
<p>You can use other common R packages to graphically inspect the input data. Look for outliers and oddities to ensure the quality of your data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu">unitted</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/unitted/man/deunitted.html">v</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>DO.pctsat <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">DO.obs</span> <span class="op">/</span> <span class="va">DO.sat</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">solar.time</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">'DO'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">DO.value</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">'DO'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>units<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">'DO.pctsat'</span>, <span class="st">'DO\n(% sat)'</span>, <span class="st">'DO\n(mg/L)'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">DO.value</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">units</span> <span class="op">~</span> <span class="va">.</span>, scale<span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span><span class="st">'variable'</span><span class="op">)</span></code></pre></div>
<p><img src="data_prep_files/figure-html/viz_inputs_DO-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>depth<span class="op">=</span><span class="st">'depth\n(m)'</span>, temp.water<span class="op">=</span><span class="st">'water temp\n(deg C)'</span>, light<span class="op">=</span><span class="st">'PAR\n(umol m^-2 s^-1)'</span><span class="op">)</span>
<span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu">unitted</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/unitted/man/deunitted.html">v</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">solar.time</span>, <span class="va">depth</span>, <span class="va">temp.water</span>, <span class="va">light</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">value</span>, <span class="va">depth</span>, <span class="va">temp.water</span>, <span class="va">light</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">type</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'depth'</span>,<span class="st">'temp.water'</span>,<span class="st">'light'</span><span class="op">)</span><span class="op">)</span>,
    units<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">labels</span><span class="op">[</span><span class="va">type</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">solar.time</span>, y<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">units</span> <span class="op">~</span> <span class="va">.</span>, scale<span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span><span class="st">'variable'</span><span class="op">)</span></code></pre></div>
<p><img src="data_prep_files/figure-html/viz_inputs_other-1.png" width="672"></p>
</div>
<div id="check-the-input-data-format" class="section level1">
<h1 class="hasAnchor">
<a href="#check-the-input-data-format" class="anchor"></a>Check the input data format</h1>
<p>Your data need to have specific column names and units. To see what is required, use the <code>metab_inputs</code> function to get a description of the required inputs for a given model type. The output of metab_inputs is a table describing the required column names, the classes and units of the values in each column, and whether that column is required or optional. The inputs are identical for the model types ‘mle’, ‘bayes’, and ‘night’, so here we’ll just print the requriements for ‘mle’.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/metab_inputs.html">metab_inputs</a></span><span class="op">(</span><span class="st">'mle'</span>, <span class="st">'data'</span><span class="op">)</span></code></pre></div>
<pre><code>##      colname          class          units     need
## 1 solar.time POSIXct,POSIXt                required
## 2     DO.obs        numeric      mgO2 L^-1 required
## 3     DO.sat        numeric      mgO2 L^-1 required
## 4      depth        numeric              m required
## 5 temp.water        numeric           degC required
## 6      light        numeric umol m^-2 s^-1 required
## 7  discharge        numeric       m^3 s^-1 optional</code></pre>
<p>Also read through the help page at <code><a href="../reference/mm_data.html">?mm_data</a></code> for more detailed variable definitions and requirements.</p>
</div>
<div id="prepare-the-timestamps" class="section level1">
<h1 class="hasAnchor">
<a href="#prepare-the-timestamps" class="anchor"></a>Prepare the timestamps</h1>
<p>To prepare your timestamps for metabolism modeling, you need to convert from the initial number or text format into POSIXct with the correct timezone (tz), then to solar mean time.</p>
<div id="step-1-posixct" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-posixct" class="anchor"></a>Step 1: POSIXct</h2>
<p>Convert your logger-format data to POSIXct in a local timezone (with or without daylight savings, as long as you have that timezone scheme specified). Here are a few examples of specific scenarios and solutions.</p>
<div id="starting-with-numeric-datetimes-e-g--from-pmes" class="section level3">
<h3 class="hasAnchor">
<a href="#starting-with-numeric-datetimes-e-g--from-pmes" class="anchor"></a>Starting with numeric datetimes, e.g., from PMEs</h3>
<p>If you have datetimes stored in seconds since 1/1/1970 at Greenwich (i.e., in UTC):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num.time</span> <span class="op">&lt;-</span> <span class="fl">1471867200</span>
<span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">num.time</span>, origin<span class="op">=</span><span class="st">'1970-01-01'</span>, tz<span class="op">=</span><span class="st">'UTC'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 UTC"</code></pre>
<p>If you have datetimes stored in seconds since 1/1/1970 at Laramie, WY (i.e., in MST, no daylight savings):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num.time</span> <span class="op">&lt;-</span> <span class="fl">1471867200</span>
<span class="op">(</span><span class="va">posix.time.nominalUTC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">num.time</span>, origin<span class="op">=</span><span class="st">'1970-01-01'</span>, tz<span class="op">=</span><span class="st">'UTC'</span><span class="op">)</span><span class="op">)</span> <span class="co"># the numbers get treated as UTC no matter what tz you request</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 UTC"</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/force_tz.html">force_tz</a></span><span class="op">(</span><span class="va">posix.time.nominalUTC</span>, <span class="st">'Etc/GMT+7'</span><span class="op">)</span><span class="op">)</span> <span class="co"># +7 = mountain standard time</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 -07"</code></pre>
</div>
<div id="starting-with-text-timestamps" class="section level3">
<h3 class="hasAnchor">
<a href="#starting-with-text-timestamps" class="anchor"></a>Starting with text timestamps</h3>
<p>If you have datetimes stored as text timestamps in UTC, you can bypass the conversion to local time and just start with UTC. Then rather than using <code><a href="../reference/calc_solar_time.html">calc_solar_time()</a></code> in Step 2, you’ll use <code><a href="../reference/convert_UTC_to_solartime.html">convert_UTC_to_solartime()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="st">'2016-08-22 12:00:00'</span>
<span class="op">(</span><span class="va">posix.time.utc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, tz<span class="op">=</span><span class="st">'UTC'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 UTC"</code></pre>
<p>If you have datetimes stored as text timestamps in EST/EDT (with daylight savings):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="st">'2016-08-22 12:00:00'</span>
<span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d %H:%M:%S"</span>, tz<span class="op">=</span><span class="st">'America/New_York'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 EDT"</code></pre>
<p>If you have datetimes stored as text timestamps in EST (no daylight savings):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">text.time</span> <span class="op">&lt;-</span> <span class="st">'2016-08-22 12:00:00'</span>
<span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d %H:%M:%S"</span>, tz<span class="op">=</span><span class="st">'Etc/GMT+5'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 -05"</code></pre>
<p>See <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="uri">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a> for a list of timezone names.</p>
</div>
<div id="starting-with-chron-datetimes" class="section level3">
<h3 class="hasAnchor">
<a href="#starting-with-chron-datetimes" class="anchor"></a>Starting with <code>chron</code> datetimes</h3>
<p>If you have datetimes stored in the <code>chron</code> time format in EST (no daylight savings):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chron.time</span> <span class="op">&lt;-</span> <span class="fu">chron</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chron/man/chron.html">chron</a></span><span class="op">(</span><span class="st">'08/22/16'</span>, <span class="st">'12:00:00'</span><span class="op">)</span>
<span class="va">time.format</span> <span class="op">&lt;-</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>
<span class="va">text.time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">chron.time</span>, <span class="va">time.format</span><span class="op">)</span> <span class="co"># direct as.POSIXct time works poorly</span>
<span class="op">(</span><span class="va">posix.time.localtz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">text.time</span>, format<span class="op">=</span><span class="va">time.format</span>, tz<span class="op">=</span><span class="st">'Etc/GMT+5'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-22 12:00:00 -05"</code></pre>
</div>
</div>
<div id="step-2-solar-time" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-solar-time" class="anchor"></a>Step 2: Solar time</h2>
<p>Now convert from local time to solar time. In <code>streamMetabolizer</code> vocabulary, <code>solar.time</code> specifically means mean solar time, the kind where every day is exactly 24 hours, in contrast to apparent solar time. You’re ready for this step when you have the correct time in a local timezone and <code><a href="http://lubridate.tidyverse.org/reference/tz.html">lubridate::tz(yourtime)</a></code> reflects the correct timezone.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/tz.html">tz</a></span><span class="op">(</span><span class="va">posix.time.localtz</span><span class="op">)</span> <span class="co"># yep, we want and have the code for EST</span></code></pre></div>
<pre><code>## [1] "Etc/GMT+5"</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">posix.time.solar</span> <span class="op">&lt;-</span> <span class="fu">streamMetabolizer</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_solar_time.html">calc_solar_time</a></span><span class="op">(</span><span class="va">posix.time.localtz</span>, longitude<span class="op">=</span><span class="op">-</span><span class="fl">106.3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2016-08-22 09:55:58 UTC"</code></pre>
</div>
</div>
<div id="other-data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#other-data-preparation" class="anchor"></a>Other data preparation</h1>
<p>streamMetabolizer offers many functions to help you prepare your data for modeling. We’ll add more to this section later. For now, we recommend that you explore the help pages for the following functions:</p>
<ul>
<li><code>calc_depth</code></li>
<li><code>calc_DO_sat</code></li>
<li><code>calc_light</code></li>
<li><code>convert_date_to_doyhr</code></li>
<li><code>convert_localtime_to_UTC</code></li>
<li><code>convert_UTC_to_solartime</code></li>
<li><code>convert_k600_to_kGAS</code></li>
<li><code>convert_PAR_to_SW</code></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alison P. Appling, Robert O. Hall, Maite Arroita, Charles B. Yackulic.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
