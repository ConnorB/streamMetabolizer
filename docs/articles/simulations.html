<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="streamMetabolizer">
<title>Simulations • streamMetabolizer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulations">
<meta property="og:description" content="streamMetabolizer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">streamMetabolizer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_prep.html">Data Preparation</a>
    <a class="dropdown-item" href="../articles/get_started.html">Quickstart</a>
    <a class="dropdown-item" href="../articles/gpp_er_eqs.html">GPP and ER Equations</a>
    <a class="dropdown-item" href="../articles/installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/model_structures.html">Model Structures</a>
    <a class="dropdown-item" href="../articles/models_bayes.html">Bayesian Models</a>
    <a class="dropdown-item" href="../articles/models_mle.html">MLE Models</a>
    <a class="dropdown-item" href="../articles/ode_methods.html">ODE Methods</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USGS-R/streamMetabolizer/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulations</h1>
                        <h4 data-toc-skip class="author">Alison
Appling</h4>
            
            <h4 data-toc-skip class="date">2023-07-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/streamMetabolizer/blob/HEAD/vignettes/simulations.Rmd" class="external-link"><code>vignettes/simulations.Rmd</code></a></small>
      <div class="d-none name"><code>simulations.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette shows how to simulate dissolved oxygen ‘observations’
for the purpose of exploring and testing metabolism models.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Load streamMetabolizer and some helper packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USGS-R/streamMetabolizer" class="external-link">streamMetabolizer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Get some data to work with: here we’re requesting three days of data
at 15-minute resolution. Thanks to Bob Hall for the test data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'3'</span>, <span class="st">'15'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-sim-model">Creating a Sim Model<a class="anchor" aria-label="anchor" href="#creating-a-sim-model"></a>
</h2>
<p>To create a simulation model, you should</p>
<ol style="list-style-type: decimal">
<li>Choose a model structure</li>
<li>Choose daily metabolism parameters</li>
<li>Choose the other model specifications</li>
<li>Create the model</li>
<li>Generate predictions (simulations) from the model</li>
</ol>
<div class="section level3">
<h3 id="choosing-the-model-structure">1. Choosing the model structure<a class="anchor" aria-label="anchor" href="#choosing-the-model-structure"></a>
</h3>
<p>You can simulate data using any of the GPP and ER functions available
to MLE models. Simulations are done by models of type <code>'sim'</code>
but otherwise take very similar arguments to those of an MLE model. Here
we’ll use a model where ER is a function of temperature.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">name_sim_q10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'sim'</span>, ER_fun<span class="op">=</span><span class="st">'q10temp'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="choosing-the-daily-parameters">2. Choosing the daily parameters<a class="anchor" aria-label="anchor" href="#choosing-the-daily-parameters"></a>
</h3>
<p>To simulate data, you need to specify the daily parameters
beforehand. The model structure determines which parameters are needed.
There are three good ways to learn which daily parameters you need to
specify.</p>
<div class="section level4">
<h4 id="a--trial-and-error">A. Trial and error<a class="anchor" aria-label="anchor" href="#a--trial-and-error"></a>
</h4>
<p>To learn about parameter needs by trial and error, simply create the
model with the equations you want but without daily inputs, ask for the
parameters, and read the error message to get a list of parameters. It’s
fine to use the defaults for the specifications for now.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm_sim_q10_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="va">name_sim_q10</span><span class="op">)</span>, <span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm_sim_q10_trial</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         date K600.daily GPP.daily      ER20 err.obs.sigma err.obs.phi err.proc.sigma err.proc.phi</span></span>
<span><span class="co">## 1 2012-09-18          0  13.98649 -8.731967          0.01           0            0.2            0</span></span>
<span><span class="co">## 2 2012-09-19          0   0.00000 -9.005751          0.01           0            0.2            0</span></span>
<span><span class="co">## 3 2012-09-20          0  10.25639 -6.418590          0.01           0            0.2            0</span></span>
<span><span class="co">##   discharge.daily</span></span>
<span><span class="co">## 1        20.93362</span></span>
<span><span class="co">## 2        19.08183</span></span>
<span><span class="co">## 3        17.69202</span></span></code></pre>
<p>Great: we need <code>GPP.daily</code>, <code>ER20</code>, and
<code>K600.daily</code>. Now we can pick values for those parameters and
put them in a data.frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_sim_q10a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'2012-09-'</span>,<span class="fl">18</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>, GPP.daily<span class="op">=</span><span class="fl">2.1</span>, ER20<span class="op">=</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="op">-</span><span class="fl">3</span>, K600.daily<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">params_sim_q10a</span></span></code></pre></div>
<pre><code><span><span class="co">##         date GPP.daily ER20 K600.daily</span></span>
<span><span class="co">## 1 2012-09-18       2.1   -5         16</span></span>
<span><span class="co">## 2 2012-09-19       2.1   -4         16</span></span>
<span><span class="co">## 3 2012-09-20       2.1   -3         16</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="b--generate-parameters-from-another-model">B. Generate parameters from another model<a class="anchor" aria-label="anchor" href="#b--generate-parameters-from-another-model"></a>
</h4>
<p>You can also use fitted parameters from another model as your input
for a simulation model. This method could be useful for identifying
realistic parameters and/or exploring why a model fitting process didn’t
work so well.</p>
<p>First fit an MLE model to the same data using the
<code>GPP_fun</code> and <code>ER_fun</code> you want. It’s fine (again)
to use the defaults for the specifications.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm_mle_q10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'mle'</span>, ER_fun<span class="op">=</span><span class="st">'q10temp'</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p>Then ask for the parameters in the right format (without columns for
uncertainty or messages).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_sim_q10b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm_mle_q10</span>, uncertainty<span class="op">=</span><span class="st">'none'</span>, messages<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">params_sim_q10b</span></span></code></pre></div>
<pre><code><span><span class="co">##         date GPP.daily      ER20 K600.daily</span></span>
<span><span class="co">## 1 2012-09-18  2.051333 -2.696135   22.36965</span></span>
<span><span class="co">## 2 2012-09-19  2.436224 -3.147503   24.27164</span></span>
<span><span class="co">## 3 2012-09-20  2.090918 -2.370546   22.84253</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="c--look-at-mm_name">C. Look at <code>?mm_name</code><a class="anchor" aria-label="anchor" href="#c--look-at-mm_name"></a>
</h4>
<p>Try it. We put lots of details in the help file. Check out the
documentation for the <code>GPP_fun</code> and <code>ER_fun</code> args
in particular.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">mm_name</span></span></code></pre></div>
<p>After reading the documentation you’ll create a data.frame of the
same format as in options A or B.</p>
</div>
</div>
<div class="section level3">
<h3 id="choosing-the-specifications">3. Choosing the specifications<a class="anchor" aria-label="anchor" href="#choosing-the-specifications"></a>
</h3>
<p>After choosing parameters, the next step is to choose the rest of the
specifications. The main difference between sim models and other models
is that you can choose values for the probability distributions of the
observation and/or process errors. See <code><a href="../reference/specs.html">?specs</a></code> for details
on the distribution parameters <code>err_obs_sigma</code>,
<code>err_obs_phi</code>, <code>err_proc_sigma</code>, and
<code>err_proc_phi</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">specs_sim_q10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="va">name_sim_q10</span>, err_obs_sigma<span class="op">=</span><span class="fl">0</span>, err_proc_sigma<span class="op">=</span><span class="fl">1</span>, K600_daily<span class="op">=</span><span class="cn">NULL</span>, GPP_daily<span class="op">=</span><span class="cn">NULL</span>, ER20<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">specs_sim_q10</span></span></code></pre></div>
<pre><code><span><span class="co">## Model specifications:</span></span>
<span><span class="co">##   model_name        s_np_oipcpi_tr_plrqkm.rnorm                                      </span></span>
<span><span class="co">##   day_start         4                                                                </span></span>
<span><span class="co">##   day_end           28                                                               </span></span>
<span><span class="co">##   day_tests         full_day, even_timesteps, complete_data, pos_discharge, pos_depth</span></span>
<span><span class="co">##   required_timestep NA                                                               </span></span>
<span><span class="co">##   discharge_daily   function; see element [['discharge_daily']] for details          </span></span>
<span><span class="co">##   DO_mod_1          NULL                                                             </span></span>
<span><span class="co">##   K600_daily        NULL                                                             </span></span>
<span><span class="co">##   GPP_daily         NULL                                                             </span></span>
<span><span class="co">##   ER20              NULL                                                             </span></span>
<span><span class="co">##   err_obs_sigma     0                                                                </span></span>
<span><span class="co">##   err_obs_phi       0                                                                </span></span>
<span><span class="co">##   err_proc_sigma    1                                                                </span></span>
<span><span class="co">##   err_proc_phi      0                                                                </span></span>
<span><span class="co">##   err_round         NA                                                               </span></span>
<span><span class="co">##   sim_seed          NA</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-a-model">4. Creating a model<a class="anchor" aria-label="anchor" href="#creating-a-model"></a>
</h3>
<p>Now you can create a simulation model much as you would an MLE or
Bayesian model. We’ll make two models here, one for each of the
parameter sets we created above.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm_sim_q10a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">specs_sim_q10</span>, <span class="va">dat</span>, data_daily<span class="op">=</span><span class="va">params_sim_q10a</span><span class="op">)</span></span>
<span><span class="va">mm_sim_q10b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">specs_sim_q10</span>, <span class="va">dat</span>, data_daily<span class="op">=</span><span class="va">params_sim_q10b</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-predictions">5. Generating predictions<a class="anchor" aria-label="anchor" href="#generating-predictions"></a>
</h3>
<p>Predictions and simulations are one and the same when your model is
of type <code>sim</code>. The output of <code>predict_DO</code> for
<code>sim</code> models includes three DO concentration columns.
<code>DO.pure</code> is what the DO concentrations would be if the GPP,
ER, and K600 parameters exactly described what occurred in the stream.
If there’s process error in your model, <code>DO.mod</code> will differ
from <code>DO.pure</code> in that <code>DO.mod</code> also contains the
process error as a fourth driver (on top of GPP, ER, and reaeration) of
in-situ DO concentrations. (<code>DO.mod</code> and <code>DO.pure</code>
are identical if there’s no process error.) Lastly, <code>DO.obs</code>
is a simulation of what your sensor might record; it includes everything
in <code>DO.mod</code> plus observation error representing inaccuracies
in how the sensor reads or records the DO concentration. These three
variables are plotted as a muted-color line (<code>DO.pure</code>), a
bold dark line (<code>DO.mod</code>), and brightly colored points
(<code>DO.obs</code>). <code>DO.pure</code> is mostly hidden behind the
others unless the errors are large.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/predict_DO.html">predict_DO</a></span><span class="op">(</span><span class="va">mm_sim_q10a</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         date          solar.time   DO.sat depth temp.water light  DO.pure   DO.mod   DO.obs</span></span>
<span><span class="co">## 1 2012-09-18 2012-09-18 04:05:58 9.083329  0.16       3.60     0 8.410000 8.410000 8.410000</span></span>
<span><span class="co">## 2 2012-09-18 2012-09-18 04:20:58 9.093063  0.16       3.56     0 8.333532 8.318042 8.318042</span></span>
<span><span class="co">## 3 2012-09-18 2012-09-18 04:35:58 9.105254  0.16       3.51     0 8.266667 8.260163 8.260163</span></span>
<span><span class="co">## 4 2012-09-18 2012-09-18 04:50:58 9.112582  0.16       3.48     0 8.208204 8.198160 8.198160</span></span>
<span><span class="co">## 5 2012-09-18 2012-09-18 05:05:58 9.127267  0.16       3.42     0 8.157374 8.124269 8.124269</span></span>
<span><span class="co">## 6 2012-09-18 2012-09-18 05:20:58 9.137079  0.16       3.38     0 8.113493 8.071996 8.071996</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/predict_DO.html">predict_DO</a></span><span class="op">(</span><span class="va">mm_sim_q10b</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         date          solar.time   DO.sat depth temp.water light  DO.pure   DO.mod   DO.obs</span></span>
<span><span class="co">## 1 2012-09-18 2012-09-18 04:05:58 9.083329  0.16       3.60     0 8.410000 8.410000 8.410000</span></span>
<span><span class="co">## 2 2012-09-18 2012-09-18 04:20:58 9.093063  0.16       3.56     0 8.431047 8.476206 8.476206</span></span>
<span><span class="co">## 3 2012-09-18 2012-09-18 04:35:58 9.105254  0.16       3.51     0 8.450642 8.491916 8.491916</span></span>
<span><span class="co">## 4 2012-09-18 2012-09-18 04:50:58 9.112582  0.16       3.48     0 8.468822 8.523043 8.523043</span></span>
<span><span class="co">## 5 2012-09-18 2012-09-18 05:05:58 9.127267  0.16       3.42     0 8.485984 8.497303 8.497303</span></span>
<span><span class="co">## 6 2012-09-18 2012-09-18 05:20:58 9.137079  0.16       3.38     0 8.502466 8.475084 8.475084</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm_sim_q10a</span>, y_var<span class="op">=</span><span class="st">'conc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm_sim_q10b</span>, y_var<span class="op">=</span><span class="st">'conc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-errors">Simulating Errors<a class="anchor" aria-label="anchor" href="#simulating-errors"></a>
</h2>
<p>The main purpose of simulation models is to generate DO
‘observations’ with error, i.e., noise, to see whether other models can
recover the underlying parameters despite the noise.</p>
<p>For this section we’ll use a simulation with GPP as a saturating
function of light. We’ll use method B from above to choose our daily
parameters.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">specs_sim_sat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'sim'</span>, GPP_fun<span class="op">=</span><span class="st">'satlight'</span><span class="op">)</span>, err_obs_sigma<span class="op">=</span><span class="fl">0</span>, err_proc_sigma<span class="op">=</span><span class="fl">1</span>, K600_daily<span class="op">=</span><span class="cn">NULL</span>, Pmax<span class="op">=</span><span class="cn">NULL</span>, alpha<span class="op">=</span><span class="cn">NULL</span>, ER_daily<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">params_sim_sat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'mle'</span>, GPP_fun<span class="op">=</span><span class="st">'satlight'</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span>, uncertainty<span class="op">=</span><span class="st">'none'</span>, messages<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="innovative-errors">Innovative errors<a class="anchor" aria-label="anchor" href="#innovative-errors"></a>
</h3>
<p>By default, simulations generate new noise each time you request
predictions.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm_sim_sat_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">specs_sim_sat</span>, <span class="va">dat</span>, data_daily<span class="op">=</span><span class="va">params_sim_sat</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm_sim_sat_i</span>, y_var<span class="op">=</span><span class="st">'conc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm_sim_sat_i</span>, y_var<span class="op">=</span><span class="st">'conc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-13-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="fixed-errors">Fixed errors<a class="anchor" aria-label="anchor" href="#fixed-errors"></a>
</h3>
<p>Alternatively, you can revise the value of <code>sim_seed</code> to
be a number (any number) and then the simulation produces the same noise
each time.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm_sim_sat_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="fu"><a href="../reference/revise.html">revise</a></span><span class="op">(</span><span class="va">specs_sim_sat</span>, sim_seed<span class="op">=</span><span class="fl">47</span><span class="op">)</span>, <span class="va">dat</span>, data_daily<span class="op">=</span><span class="va">params_sim_sat</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm_sim_sat_f</span>, y_var<span class="op">=</span><span class="st">'conc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm_sim_sat_f</span>, y_var<span class="op">=</span><span class="st">'conc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="inspecting-models">Inspecting Models<a class="anchor" aria-label="anchor" href="#inspecting-models"></a>
</h2>
<p>We’ll use a slightly longer dataset here to demonstrate the potential
for random noise at the levels of both the observations (every time you
run <code><a href="../reference/predict_DO.html">predict_DO()</a></code>) and the daily parameters (every time you
define <code>data_daily</code>).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'10'</span>, <span class="st">'30'</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'2012-09-'</span>,<span class="fl">18</span><span class="op">:</span><span class="fl">27</span><span class="op">)</span><span class="op">)</span>, Pmax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span><span class="op">)</span>, ER20<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, K600.daily<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'sim'</span>, GPP_fun<span class="op">=</span><span class="st">'satlight'</span>, ER_fun<span class="op">=</span><span class="st">'q10temp'</span><span class="op">)</span>, err_obs_sigma<span class="op">=</span><span class="fl">0.2</span>, err_proc_sigma<span class="op">=</span><span class="fl">1</span>, K600_daily<span class="op">=</span><span class="cn">NULL</span>, Pmax<span class="op">=</span><span class="cn">NULL</span>, alpha<span class="op">=</span><span class="cn">NULL</span>, ER20<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">specs</span>, data<span class="op">=</span><span class="va">dat</span>, data_daily<span class="op">=</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>Sim models print out their parameters with asterisks to denote that
the values are fixed rather than fitted.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm</span></span></code></pre></div>
<pre><code><span><span class="co">## metab_model of type metab_sim </span></span>
<span><span class="co">## streamMetabolizer version 0.12.1 </span></span>
<span><span class="co">## Specifications:</span></span>
<span><span class="co">##   model_name        s_np_oipcpi_tr_psrqkm.rnorm                                      </span></span>
<span><span class="co">##   day_start         4                                                                </span></span>
<span><span class="co">##   day_end           28                                                               </span></span>
<span><span class="co">##   day_tests         full_day, even_timesteps, complete_data, pos_discharge, pos_depth</span></span>
<span><span class="co">##   required_timestep NA                                                               </span></span>
<span><span class="co">##   discharge_daily   function; see element [['discharge_daily']] for details          </span></span>
<span><span class="co">##   DO_mod_1          NULL                                                             </span></span>
<span><span class="co">##   K600_daily        NULL                                                             </span></span>
<span><span class="co">##   Pmax              NULL                                                             </span></span>
<span><span class="co">##   alpha             NULL                                                             </span></span>
<span><span class="co">##   ER20              NULL                                                             </span></span>
<span><span class="co">##   err_obs_sigma     0.2                                                              </span></span>
<span><span class="co">##   err_obs_phi       0                                                                </span></span>
<span><span class="co">##   err_proc_sigma    1                                                                </span></span>
<span><span class="co">##   err_proc_phi      0                                                                </span></span>
<span><span class="co">##   err_round         NA                                                               </span></span>
<span><span class="co">##   sim_seed          NA                                                               </span></span>
<span><span class="co">## Fitting time: 0.952 secs elapsed</span></span>
<span><span class="co">## Parameters (10 dates)(* = fixed value):</span></span>
<span><span class="co">##          date K600.daily      Pmax        alpha       ER20 err.obs.sigma err.obs.phi err.proc.sigma</span></span>
<span><span class="co">## 1  2012-09-18        16* 8.499653* 0.010029735* -4.780125*          0.2           0              1 </span></span>
<span><span class="co">## 2  2012-09-19        16* 7.007731* 0.010537178* -4.657027*          0.2           0              1 </span></span>
<span><span class="co">## 3  2012-09-20        16* 3.238979* 0.009774623* -3.654986*          0.2           0              1 </span></span>
<span><span class="co">## 4  2012-09-21        16* 6.647592* 0.011448446* -5.116775*          0.2           0              1 </span></span>
<span><span class="co">## 5  2012-09-22        16* 7.267074* 0.011769600* -3.637974*          0.2           0              1 </span></span>
<span><span class="co">## 6  2012-09-23        16* 7.610239* 0.011205473* -8.047155*          0.2           0              1 </span></span>
<span><span class="co">## 7  2012-09-24        16* 8.687355* 0.008570020* -1.581533*          0.2           0              1 </span></span>
<span><span class="co">## 8  2012-09-25        16* 6.872180* 0.010270915* -5.840345*          0.2           0              1 </span></span>
<span><span class="co">## 9  2012-09-26        16* 5.671489* 0.009372155* -7.103388*          0.2           0              1 </span></span>
<span><span class="co">## 10 2012-09-27        16* 8.824851* 0.011480065* -3.531540*          0.2           0              1 </span></span>
<span><span class="co">##    err.proc.phi discharge.daily msgs.fit</span></span>
<span><span class="co">## 1            0        20.63977        NA</span></span>
<span><span class="co">## 2            0        15.55015        NA</span></span>
<span><span class="co">## 3            0        22.23704        NA</span></span>
<span><span class="co">## 4            0        23.92856        NA</span></span>
<span><span class="co">## 5            0        16.35572        NA</span></span>
<span><span class="co">## 6            0        19.46301        NA</span></span>
<span><span class="co">## 7            0        28.91927        NA</span></span>
<span><span class="co">## 8            0        19.52684        NA</span></span>
<span><span class="co">## 9            0        21.18288        NA</span></span>
<span><span class="co">## 10           0        18.35792        NA</span></span>
<span><span class="co">## Predictions (10 dates):</span></span>
<span><span class="co">##          date      GPP GPP.lower GPP.upper        ER ER.lower ER.upper msgs.fit msgs.pred</span></span>
<span><span class="co">## 1  2012-09-18 3.322718        NA        NA -2.733984       NA       NA       NA          </span></span>
<span><span class="co">## 2  2012-09-19 2.917873        NA        NA -2.714620       NA       NA       NA          </span></span>
<span><span class="co">## 3  2012-09-20 1.495126        NA        NA -2.132107       NA       NA       NA          </span></span>
<span><span class="co">## 4  2012-09-21 2.823602        NA        NA -2.997445       NA       NA       NA          </span></span>
<span><span class="co">## 5  2012-09-22 3.032138        NA        NA -2.116472       NA       NA       NA          </span></span>
<span><span class="co">## 6  2012-09-23 3.088538        NA        NA -4.810156       NA       NA       NA          </span></span>
<span><span class="co">## 7  2012-09-24 3.063456        NA        NA -0.946805       NA       NA       NA          </span></span>
<span><span class="co">## 8  2012-09-25 2.768727        NA        NA -3.188522       NA       NA       NA          </span></span>
<span><span class="co">## 9  2012-09-26 2.326526        NA        NA -3.966624       NA       NA       NA          </span></span>
<span><span class="co">## 10 2012-09-27 3.379752        NA        NA -1.901252       NA       NA       NA</span></span></code></pre>
<p>Sim models produce daily estimates of GPP and ER, which should help
in choosing simulation parameters. The GPP and ER predictions have no
error bars because they’re direct calculations from the daily
parameters.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_metab_preds.html">plot_metab_preds</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="multi-day-simulations">Multi-Day Simulations<a class="anchor" aria-label="anchor" href="#multi-day-simulations"></a>
</h2>
<p>You can also use <code>sim</code> models to simulate variation across
many days. Let’s start by generating a 60-day timeseries of water
temperature, DO.sat, etc. by concatenating 6 copies of 10 days of French
Creek data:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_metab.html">data_metab</a></span><span class="op">(</span><span class="st">'10'</span>,<span class="st">'15'</span><span class="op">)</span></span>
<span><span class="va">datlen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">solar.time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="fl">15</span>, units<span class="op">=</span><span class="st">'mins'</span><span class="op">)</span>, units<span class="op">=</span><span class="st">'days'</span><span class="op">)</span></span>
<span><span class="va">dat20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">add</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dat</span>, solar.time <span class="op">=</span> <span class="va">solar.time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="va">add</span>, units<span class="op">=</span><span class="st">'days'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can specify a distribution rather than specific values for GPP,
ER, and/or K600 parameters. In fact, this is the default if you don’t
specify daily data:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'sim'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'K600_daily'</span>,<span class="st">'GPP_daily'</span>,<span class="st">'ER_daily'</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fun</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>code<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fun</span>, <span class="st">'srcref'</span><span class="op">)</span>, example_vals<span class="op">=</span><span class="fu">fun</span><span class="op">(</span>n<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $K600_daily</span></span>
<span><span class="co">## $K600_daily$code</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $K600_daily$example_vals</span></span>
<span><span class="co">##  [1] 4.9025870 5.0918110 2.2618392 6.7995286 0.5075600 0.4521139 0.0000000 0.0000000 1.4694245</span></span>
<span><span class="co">## [10] 2.4775717</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $GPP_daily</span></span>
<span><span class="co">## $GPP_daily$code</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $GPP_daily$example_vals</span></span>
<span><span class="co">##  [1]  1.450572  7.712916 14.157354  9.248489  5.820494  8.838564  2.804051  8.920846 12.826411</span></span>
<span><span class="co">## [10] 11.956801</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ER_daily</span></span>
<span><span class="co">## $ER_daily$code</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ER_daily$example_vals</span></span>
<span><span class="co">##  [1]  -6.689044 -10.631768  -7.973008  -8.299484 -10.170224  -9.557446 -15.762513 -10.713301</span></span>
<span><span class="co">##  [9] -10.482192  -3.897427</span></span></code></pre>
<p>These functions get called to generate new values for K600.daily,
GPP.daily, and ER.daily each time you call <code>get_params</code>,
<code>predict_metab</code>, or <code>predict_DO</code>. (They’ll be the
same random values each time if you set <code>sim_seed</code>.)</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">sp</span>, <span class="va">dat20</span>, data_daily<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'date'</span>,<span class="st">'K600.daily'</span>,<span class="st">'GPP.daily'</span>,<span class="st">'ER.daily'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##          date K600.daily GPP.daily   ER.daily</span></span>
<span><span class="co">## 1  2012-09-18 0.00000000  6.137330  -2.702624</span></span>
<span><span class="co">## 2  2012-09-19 2.08513305 11.856503  -6.711595</span></span>
<span><span class="co">## 3  2012-09-20 6.78123225  5.484092  -3.681549</span></span>
<span><span class="co">## 4  2012-09-21 0.00000000  7.741535  -7.876268</span></span>
<span><span class="co">## 5  2012-09-22 0.00000000  2.895681 -11.752765</span></span>
<span><span class="co">## 6  2012-09-23 0.00000000  5.984418  -4.774092</span></span>
<span><span class="co">## 7  2012-09-24 0.00000000 11.225455 -20.283619</span></span>
<span><span class="co">## 8  2012-09-25 5.26256886 14.179186   0.000000</span></span>
<span><span class="co">## 9  2012-09-26 1.78365529  6.444187  -6.543930</span></span>
<span><span class="co">## 10 2012-09-27 1.32286542 11.281657  -8.241440</span></span>
<span><span class="co">## 11 2012-09-28 5.03530970  4.974579  -6.984253</span></span>
<span><span class="co">## 12 2012-09-29 0.00000000 14.648056 -11.888345</span></span>
<span><span class="co">## 13 2012-09-30 4.22977335 10.472624  -7.378722</span></span>
<span><span class="co">## 14 2012-10-01 2.91720935 10.251983 -11.848999</span></span>
<span><span class="co">## 15 2012-10-02 0.03813306  0.000000 -11.445151</span></span>
<span><span class="co">## 16 2012-10-03 0.00000000  8.885952 -14.978383</span></span>
<span><span class="co">## 17 2012-10-04 3.22201530  6.296273  -6.880617</span></span>
<span><span class="co">## 18 2012-10-05 0.00000000  4.046251 -12.466123</span></span>
<span><span class="co">## 19 2012-10-06 0.00000000  5.128637  -5.581942</span></span>
<span><span class="co">## 20 2012-10-07 0.00000000  0.000000  -6.158762</span></span></code></pre>
<p>You can also set <code>err_obs_sigma</code> and other error terms as
daily values and/or functions. The defaults are simple numeric values
that get replicated to every date, but the values can also be vectors or
functions, as with <code>GPP_daily</code>, etc.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="st">'sim'</span>, err_obs_sigma<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">...</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.01</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span>, err_proc_sigma<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.1</span>, <span class="fl">0.005</span><span class="op">)</span>, err_proc_phi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out<span class="op">=</span><span class="fl">20</span><span class="op">)</span>, GPP_daily<span class="op">=</span><span class="fl">3</span>, ER_daily<span class="op">=</span><span class="op">-</span><span class="fl">4</span>, K600_daily<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">sp</span>, <span class="va">dat20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          date K600.daily GPP.daily ER.daily err.obs.sigma err.obs.phi err.proc.sigma err.proc.phi</span></span>
<span><span class="co">## 1  2012-09-18         16         3       -4          0.19           0     0.10761603   0.00000000</span></span>
<span><span class="co">## 2  2012-09-19         16         3       -4          0.36           0     0.09543672   0.05263158</span></span>
<span><span class="co">## 3  2012-09-20         16         3       -4          0.51           0     0.09789604   0.10526316</span></span>
<span><span class="co">## 4  2012-09-21         16         3       -4          0.64           0     0.10341750   0.15789474</span></span>
<span><span class="co">## 5  2012-09-22         16         3       -4          0.75           0     0.09840703   0.21052632</span></span>
<span><span class="co">## 6  2012-09-23         16         3       -4          0.84           0     0.10268187   0.26315789</span></span>
<span><span class="co">## 7  2012-09-24         16         3       -4          0.91           0     0.10021612   0.31578947</span></span>
<span><span class="co">## 8  2012-09-25         16         3       -4          0.96           0     0.10491072   0.36842105</span></span>
<span><span class="co">## 9  2012-09-26         16         3       -4          0.99           0     0.10084631   0.42105263</span></span>
<span><span class="co">## 10 2012-09-27         16         3       -4          1.00           0     0.09295924   0.47368421</span></span>
<span><span class="co">## 11 2012-09-28         16         3       -4          0.99           0     0.10547392   0.52631579</span></span>
<span><span class="co">## 12 2012-09-29         16         3       -4          0.96           0     0.09843129   0.57894737</span></span>
<span><span class="co">## 13 2012-09-30         16         3       -4          0.91           0     0.11077018   0.63157895</span></span>
<span><span class="co">## 14 2012-10-01         16         3       -4          0.84           0     0.10130353   0.68421053</span></span>
<span><span class="co">## 15 2012-10-02         16         3       -4          0.75           0     0.10201820   0.73684211</span></span>
<span><span class="co">## 16 2012-10-03         16         3       -4          0.64           0     0.10864924   0.78947368</span></span>
<span><span class="co">## 17 2012-10-04         16         3       -4          0.51           0     0.10648158   0.84210526</span></span>
<span><span class="co">## 18 2012-10-05         16         3       -4          0.36           0     0.10177324   0.89473684</span></span>
<span><span class="co">## 19 2012-10-06         16         3       -4          0.19           0     0.10140780   0.94736842</span></span>
<span><span class="co">## 20 2012-10-07         16         3       -4          0.00           0     0.09610893   1.00000000</span></span>
<span><span class="co">##    discharge.daily</span></span>
<span><span class="co">## 1         20.89427</span></span>
<span><span class="co">## 2         18.19500</span></span>
<span><span class="co">## 3         16.03852</span></span>
<span><span class="co">## 4         20.62922</span></span>
<span><span class="co">## 5         23.47987</span></span>
<span><span class="co">## 6         18.11999</span></span>
<span><span class="co">## 7         18.90556</span></span>
<span><span class="co">## 8         20.99952</span></span>
<span><span class="co">## 9         20.29894</span></span>
<span><span class="co">## 10        11.69843</span></span>
<span><span class="co">## 11        15.37003</span></span>
<span><span class="co">## 12        17.98199</span></span>
<span><span class="co">## 13        18.70852</span></span>
<span><span class="co">## 14        14.94103</span></span>
<span><span class="co">## 15        19.98327</span></span>
<span><span class="co">## 16        19.81029</span></span>
<span><span class="co">## 17        24.50395</span></span>
<span><span class="co">## 18        14.74064</span></span>
<span><span class="co">## 19        12.27955</span></span>
<span><span class="co">## 20        19.81483</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-21-1.png" width="700">
The above simulation emphasized day-to-day variation in
<code>err_obs_sigma</code>. Here’s a simulation emphasizing variation in
<code>err_proc_sigma</code> and <code>err_proc_phi</code>:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="st">'sim'</span>, err_obs_sigma<span class="op">=</span><span class="fl">0.01</span>, err_proc_sigma<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">4</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, err_proc_phi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span>, length.out<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, times<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, GPP_daily<span class="op">=</span><span class="fl">3</span>, ER_daily<span class="op">=</span><span class="op">-</span><span class="fl">4</span>, K600_daily<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">sp</span>, <span class="va">dat20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          date K600.daily GPP.daily ER.daily err.obs.sigma err.obs.phi err.proc.sigma err.proc.phi</span></span>
<span><span class="co">## 1  2012-09-18         16         3       -4          0.01           0            0.5   0.00000000</span></span>
<span><span class="co">## 2  2012-09-19         16         3       -4          0.01           0            0.5   0.08888889</span></span>
<span><span class="co">## 3  2012-09-20         16         3       -4          0.01           0            0.5   0.17777778</span></span>
<span><span class="co">## 4  2012-09-21         16         3       -4          0.01           0            0.5   0.26666667</span></span>
<span><span class="co">## 5  2012-09-22         16         3       -4          0.01           0            0.5   0.35555556</span></span>
<span><span class="co">## 6  2012-09-23         16         3       -4          0.01           0            0.5   0.44444444</span></span>
<span><span class="co">## 7  2012-09-24         16         3       -4          0.01           0            0.5   0.53333333</span></span>
<span><span class="co">## 8  2012-09-25         16         3       -4          0.01           0            0.5   0.62222222</span></span>
<span><span class="co">## 9  2012-09-26         16         3       -4          0.01           0            0.5   0.71111111</span></span>
<span><span class="co">## 10 2012-09-27         16         3       -4          0.01           0            0.5   0.80000000</span></span>
<span><span class="co">## 11 2012-09-28         16         3       -4          0.01           0            4.0   0.00000000</span></span>
<span><span class="co">## 12 2012-09-29         16         3       -4          0.01           0            4.0   0.08888889</span></span>
<span><span class="co">## 13 2012-09-30         16         3       -4          0.01           0            4.0   0.17777778</span></span>
<span><span class="co">## 14 2012-10-01         16         3       -4          0.01           0            4.0   0.26666667</span></span>
<span><span class="co">## 15 2012-10-02         16         3       -4          0.01           0            4.0   0.35555556</span></span>
<span><span class="co">## 16 2012-10-03         16         3       -4          0.01           0            4.0   0.44444444</span></span>
<span><span class="co">## 17 2012-10-04         16         3       -4          0.01           0            4.0   0.53333333</span></span>
<span><span class="co">## 18 2012-10-05         16         3       -4          0.01           0            4.0   0.62222222</span></span>
<span><span class="co">## 19 2012-10-06         16         3       -4          0.01           0            4.0   0.71111111</span></span>
<span><span class="co">## 20 2012-10-07         16         3       -4          0.01           0            4.0   0.80000000</span></span>
<span><span class="co">##    discharge.daily</span></span>
<span><span class="co">## 1         22.52595</span></span>
<span><span class="co">## 2         17.52829</span></span>
<span><span class="co">## 3         21.02542</span></span>
<span><span class="co">## 4         18.27963</span></span>
<span><span class="co">## 5         23.45082</span></span>
<span><span class="co">## 6         18.73533</span></span>
<span><span class="co">## 7         22.11049</span></span>
<span><span class="co">## 8         20.37990</span></span>
<span><span class="co">## 9         19.54233</span></span>
<span><span class="co">## 10        22.46322</span></span>
<span><span class="co">## 11        19.95329</span></span>
<span><span class="co">## 12        19.28491</span></span>
<span><span class="co">## 13        21.68564</span></span>
<span><span class="co">## 14        20.63351</span></span>
<span><span class="co">## 15        21.17957</span></span>
<span><span class="co">## 16        15.48996</span></span>
<span><span class="co">## 17        18.90927</span></span>
<span><span class="co">## 18        15.95994</span></span>
<span><span class="co">## 19        15.81244</span></span>
<span><span class="co">## 20        21.75694</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_DO_preds.html">plot_DO_preds</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-22-1.png" width="700">
The daily parameter functions that you assign in <code><a href="../reference/specs.html">specs()</a></code>
can refer to previous daily parameters in the list. For example,
ER_daily can be a function of <code>GPP.daily</code>. Values of
<code>GPP.daily</code> may have been specified in the
<code>GPP.daily</code> column of <code>data_daily</code> or in the
<code>GPP_daily</code> argument to <code><a href="../reference/specs.html">specs()</a></code>; the ER function
should refer to it with its period-separated name,
<code>GPP.daily</code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="st">'sim'</span>, err_obs_sigma<span class="op">=</span><span class="fl">0.01</span>, err_proc_sigma<span class="op">=</span><span class="fl">0.4</span>, K600_daily<span class="op">=</span><span class="fl">16</span>, GPP_daily<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, ER_daily<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">GPP.daily</span>, <span class="va">...</span><span class="op">)</span> <span class="va">GPP.daily</span><span class="op">*</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="va">sp</span>, <span class="va">dat20</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          date K600.daily GPP.daily ER.daily err.obs.sigma err.obs.phi err.proc.sigma err.proc.phi</span></span>
<span><span class="co">## 1  2012-09-18         16       2.1     -4.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 2  2012-09-19         16       3.6     -7.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 3  2012-09-20         16       4.6     -9.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 4  2012-09-21         16       3.2     -6.4          0.01           0            0.4            0</span></span>
<span><span class="co">## 5  2012-09-22         16       3.3     -6.6          0.01           0            0.4            0</span></span>
<span><span class="co">## 6  2012-09-23         16       5.6    -11.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 7  2012-09-24         16       4.3     -8.6          0.01           0            0.4            0</span></span>
<span><span class="co">## 8  2012-09-25         16       2.7     -5.4          0.01           0            0.4            0</span></span>
<span><span class="co">## 9  2012-09-26         16       4.6     -9.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 10 2012-09-27         16       3.1     -6.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 11 2012-09-28         16       4.2     -8.4          0.01           0            0.4            0</span></span>
<span><span class="co">## 12 2012-09-29         16       4.2     -8.4          0.01           0            0.4            0</span></span>
<span><span class="co">## 13 2012-09-30         16       3.4     -6.8          0.01           0            0.4            0</span></span>
<span><span class="co">## 14 2012-10-01         16       3.4     -6.8          0.01           0            0.4            0</span></span>
<span><span class="co">## 15 2012-10-02         16       4.5     -9.0          0.01           0            0.4            0</span></span>
<span><span class="co">## 16 2012-10-03         16       4.7     -9.4          0.01           0            0.4            0</span></span>
<span><span class="co">## 17 2012-10-04         16       4.0     -8.0          0.01           0            0.4            0</span></span>
<span><span class="co">## 18 2012-10-05         16       3.6     -7.2          0.01           0            0.4            0</span></span>
<span><span class="co">## 19 2012-10-06         16       2.2     -4.4          0.01           0            0.4            0</span></span>
<span><span class="co">## 20 2012-10-07         16       4.6     -9.2          0.01           0            0.4            0</span></span>
<span><span class="co">##    discharge.daily</span></span>
<span><span class="co">## 1         16.64428</span></span>
<span><span class="co">## 2         20.11525</span></span>
<span><span class="co">## 3         14.79449</span></span>
<span><span class="co">## 4         27.84836</span></span>
<span><span class="co">## 5         17.93868</span></span>
<span><span class="co">## 6         26.30196</span></span>
<span><span class="co">## 7         20.44411</span></span>
<span><span class="co">## 8         17.07698</span></span>
<span><span class="co">## 9         21.96341</span></span>
<span><span class="co">## 10        19.36608</span></span>
<span><span class="co">## 11        18.80272</span></span>
<span><span class="co">## 12        18.28832</span></span>
<span><span class="co">## 13        22.89088</span></span>
<span><span class="co">## 14        20.20072</span></span>
<span><span class="co">## 15        18.25459</span></span>
<span><span class="co">## 16        18.99789</span></span>
<span><span class="co">## 17        17.42827</span></span>
<span><span class="co">## 18        18.84909</span></span>
<span><span class="co">## 19        24.14172</span></span>
<span><span class="co">## 20        17.85479</span></span></code></pre>
<p>The K600_daily function can also take advantage of pre-specified
model structures relating K to discharge. As of December 2016, the
<code>Kb</code> formulation (<code>pool_K600 = 'binned'</code>) is the
only one available. But it’s a good one! See which parameters you can
set by calling <code>specs</code> one preliminary time with a Kb model
name:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specs.html">specs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mm_name.html">mm_name</a></span><span class="op">(</span><span class="st">'sim'</span>, pool_K600<span class="op">=</span><span class="st">'binned'</span>, ER_fun<span class="op">=</span><span class="st">'q10temp'</span><span class="op">)</span>, sim_seed<span class="op">=</span><span class="fl">6332</span><span class="op">)</span></span></code></pre></div>
<p>The new and relevant arguments are
<code>K600_lnQ_nodes_centers</code>,
<code>K600_lnQ_cnode_meanlog</code>, <code>K600_lnQ_cnode_sdlog</code>,
<code>K600_lnQ_nodediffs_meanlog</code>,
<code>K600_lnQ_nodediffs_sdlog</code>, and
<code>lnK600_lnQ_nodes</code>. The defaults might work just fine for
you, and changing <code>lnK600_lnQ_nodes</code> is especially
non-recommended. It’s probably useful to dial down the noise relating
K600.daily to lnK600_lnQ_nodes:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metab.html">metab</a></span><span class="op">(</span><span class="fu"><a href="../reference/revise.html">revise</a></span><span class="op">(</span><span class="va">sp</span>, K600_daily<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">K600_daily_predlog</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">K600_daily_predlog</span><span class="op">)</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">dat20</span><span class="op">)</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_params.html">get_params</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span>
<span><span class="va">pars</span></span></code></pre></div>
<pre><code><span><span class="co">##          date discharge.daily K600.daily GPP.daily       ER20 err.obs.sigma err.obs.phi</span></span>
<span><span class="co">## 1  2012-09-18        17.95254   3.276343 10.861268  -4.839845          0.01           0</span></span>
<span><span class="co">## 2  2012-09-19        19.74833   4.258166  4.278131  -4.599670          0.01           0</span></span>
<span><span class="co">## 3  2012-09-20        24.11093   6.660064  4.872679  -5.062334          0.01           0</span></span>
<span><span class="co">## 4  2012-09-21        19.23720   2.995546 10.715018  -6.466619          0.01           0</span></span>
<span><span class="co">## 5  2012-09-22        21.83327   5.494783  3.220689  -7.685111          0.01           0</span></span>
<span><span class="co">## 6  2012-09-23        18.66778   3.104385  9.406120 -12.425723          0.01           0</span></span>
<span><span class="co">## 7  2012-09-24        21.66651   5.629606  7.829844 -13.288060          0.01           0</span></span>
<span><span class="co">## 8  2012-09-25        23.27941   4.914728 12.902530  -5.806561          0.01           0</span></span>
<span><span class="co">## 9  2012-09-26        18.18747   3.135139  1.363060 -10.178470          0.01           0</span></span>
<span><span class="co">## 10 2012-09-27        22.76868   5.704705  4.159898  -7.718060          0.01           0</span></span>
<span><span class="co">## 11 2012-09-28        19.56126   3.960659  8.879820  -6.513834          0.01           0</span></span>
<span><span class="co">## 12 2012-09-29        20.50053   4.006042 10.583638  -4.917149          0.01           0</span></span>
<span><span class="co">## 13 2012-09-30        17.56558   2.382708  1.277344  -7.584540          0.01           0</span></span>
<span><span class="co">## 14 2012-10-01        23.58988   6.083747  6.481855 -12.646758          0.01           0</span></span>
<span><span class="co">## 15 2012-10-02        20.66988   4.140573  4.473403 -10.472093          0.01           0</span></span>
<span><span class="co">## 16 2012-10-03        22.45883   5.352439  9.705709 -15.281010          0.01           0</span></span>
<span><span class="co">## 17 2012-10-04        24.31525   6.654290  3.102061  -5.419053          0.01           0</span></span>
<span><span class="co">## 18 2012-10-05        20.59640   4.464318  1.188528  -8.078135          0.01           0</span></span>
<span><span class="co">## 19 2012-10-06        22.09928   5.644090  9.026385  -9.683760          0.01           0</span></span>
<span><span class="co">## 20 2012-10-07        23.84877   6.174243  7.358561  -8.962819          0.01           0</span></span>
<span><span class="co">##    err.proc.sigma err.proc.phi</span></span>
<span><span class="co">## 1             0.2            0</span></span>
<span><span class="co">## 2             0.2            0</span></span>
<span><span class="co">## 3             0.2            0</span></span>
<span><span class="co">## 4             0.2            0</span></span>
<span><span class="co">## 5             0.2            0</span></span>
<span><span class="co">## 6             0.2            0</span></span>
<span><span class="co">## 7             0.2            0</span></span>
<span><span class="co">## 8             0.2            0</span></span>
<span><span class="co">## 9             0.2            0</span></span>
<span><span class="co">## 10            0.2            0</span></span>
<span><span class="co">## 11            0.2            0</span></span>
<span><span class="co">## 12            0.2            0</span></span>
<span><span class="co">## 13            0.2            0</span></span>
<span><span class="co">## 14            0.2            0</span></span>
<span><span class="co">## 15            0.2            0</span></span>
<span><span class="co">## 16            0.2            0</span></span>
<span><span class="co">## 17            0.2            0</span></span>
<span><span class="co">## 18            0.2            0</span></span>
<span><span class="co">## 19            0.2            0</span></span>
<span><span class="co">## 20            0.2            0</span></span></code></pre>
<p>In this model, even the K~Q relationship is simulated on each call to
<code>get_params</code>, <code>predict_metab</code>, or
<code>predict_DO</code>. You can inspect the relationship by looking at
the <code>K600_eqn</code> attribute to the output of
<code>get_params</code>:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pars</span>, <span class="st">'K600_eqn'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $K600_lnQ_nodes_centers</span></span>
<span><span class="co">## [1] 2.7 2.9 3.1 3.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $K600_lnQ_cnode_meanlog</span></span>
<span><span class="co">##  [1] 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759</span></span>
<span><span class="co">## [11] 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759 1.791759</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $K600_lnQ_cnode_sdlog</span></span>
<span><span class="co">##  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $K600_lnQ_nodediffs_meanlog</span></span>
<span><span class="co">##  [1] 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $K600_lnQ_nodediffs_sdlog</span></span>
<span><span class="co">##  [1] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $lnK600_lnQ_nodes</span></span>
<span><span class="co">## [1] 0.4988654 1.1196713 1.7336039 1.9001201</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $K600_daily_predlog</span></span>
<span><span class="co">##  [1] 1.081589 1.374665 1.802429 1.294170 1.682755 1.201935 1.659220 1.773209 1.121921 1.754740</span></span>
<span><span class="co">## [11] 1.345448 1.489414 1.013952 1.784239 1.514669 1.743331 1.809455 1.503737 1.719929 1.793327</span></span></code></pre>
<p>The centers and nodes are the essential pieces of the final piecewise
relationship (blue points and line). We can also identify the
predictions for specific dates and discharges along that line (purple
points) and the K600 params that result from adding noise to those
predictions (red points):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">KQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pars</span>, <span class="st">'K600_eqn'</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'K600_lnQ_nodes_centers'</span>, <span class="st">'lnK600_lnQ_nodes'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Kpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pars</span>, <span class="va">date</span>, <span class="va">discharge.daily</span>, <span class="va">K600.daily</span><span class="op">)</span>, K600_daily_predlog<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pars</span>, <span class="st">'K600_eqn'</span><span class="op">)</span><span class="op">$</span><span class="va">K600_daily_predlog</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">KQ</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">K600_lnQ_nodes_centers</span>, y<span class="op">=</span><span class="va">lnK600_lnQ_nodes</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Kpred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">discharge.daily</span><span class="op">)</span>, y<span class="op">=</span><span class="va">K600_daily_predlog</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'purple'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Kpred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">discharge.daily</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">K600.daily</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>```</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alison P. Appling, Robert O. Hall, Maite Arroita, Charles B. Yackulic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
